<mat-sidenav-container [hasBackdrop]="false">
  <mat-sidenav
    [fixedInViewport]="true"
    [fixedTopGap]="36"
    [fixedBottomGap]="36"
    mode="over"
    #sidenav
  >
    <ng-container *ngIf="useFilters">
      <div class="ia-filter-btn-close-container">
        <ia-button
          (onClick)="sidenav.close()"
          appearance="mat-icon-button"
          type="button"
          icon="close"
        ></ia-button>
      </div>
      <ia-filter
        [datatableHandler]="datatableHandler"
        [inputPropertiesMap]="filterInputPropertiesMap"
      ></ia-filter
    ></ng-container>
  </mat-sidenav>
  <mat-sidenav-content>
    <ng-container *ngIf="datatableHandler">
      <div class="ia-loading-shade" *ngIf="ajax && datatableHandler.isLoading">
        <mat-spinner></mat-spinner>
      </div>
      <div class="mat-elevation-z8 ia-table-container">
        <div class="mat-paginator">
          <div class="mat-paginator-outer-container">
            <div class="mat-paginator-container ia-table-actions">
              <ia-button
                *ngIf="useCreateAction"
                css="height: 44px; width: 100%;"
                (onClick)="openCreateDialog()"
                appearance="mat-raised-button"
                color="primary"
                type="button"
                [icon]="actionCreateIcon"
                [label]="createButtonText"
              >
              </ia-button>
              <ia-input
                *ngIf="useSearch"
                [type]="searchOptions.type"
                [props]="searchOptions.metadata"
                (onChange)="onSearchChange($event)"
              ></ia-input>
              <ia-button
                *ngIf="useFilters"
                css="height: 44px; width: 100%"
                appearance="mat-stroked-button"
                (onClick)="sidenav.toggle()"
                type="button"
                icon="filter_list"
                label="Filter"
              >
              </ia-button>
            </div>
          </div>
        </div>
        <div class="ia-table-responsive">
          <table
            mat-table
            matSort
            style="width: 100%; margin-bottom: 0"
            [dataSource]="tableDataSource"
          >
            <ng-container *ngFor="let columnName of columnNamesWithoutActions">
              <ng-container [matColumnDef]="columnName">
                <ng-container
                  *ngIf="sortOptions.includes(columnName); else nonSortableHeaderCell"
                >
                  <th mat-header-cell mat-sort-header *matHeaderCellDef>
                    <div class="ia-cell-wrapper">
                      {{ inputPropertiesMap[columnName].props.label }}
                    </div>
                  </th>
                </ng-container>
                <ng-template #nonSortableHeaderCell>
                  <th mat-header-cell *matHeaderCellDef>
                    <div class="ia-cell-wrapper">
                      {{ inputPropertiesMap[columnName].props.label }}
                    </div>
                  </th>
                </ng-template>

                <td mat-cell *matCellDef="let element">
                  <div class="ia-cell-wrapper">
                    <ia-display
                      [data]="element[columnName]"
                      [type]="inputPropertiesMap[columnName].inputType"
                      [props]="inputPropertiesMap[columnName].props"
                    ></ia-display>
                  </div>
                </td>
              </ng-container>
            </ng-container>

            <ng-container
              [matColumnDef]="actionsColumnName"
              *ngIf="useCellActions"
            >
              <th mat-header-cell *matHeaderCellDef>
                {{ actionsColumnLabel }}
              </th>
              <td mat-cell *matCellDef="let element">
                <div class="flex-nowrap">
                  <button
                    mat-icon-button
                    (click)="openReadDialog(element)"
                    *ngIf="useReadAction"
                  >
                    <mat-icon>{{ actionReadIcon }}</mat-icon>
                  </button>
                  <button
                    *ngIf="useUpdateAction"
                    mat-icon-button
                    (click)="openUpdateDialog(element)"
                  >
                    <mat-icon>{{ actionUpdateIcon }}</mat-icon>
                  </button>
                  <button
                    *ngIf="useDeleteAction"
                    mat-icon-button
                    (click)="openDeleteDialog(element)"
                  >
                    <mat-icon color="warn">{{ actionDeleteIcon }}</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr class="mat-row" *matNoDataRow>
              <td
                align="center"
                class="mat-cell"
                [attr.colspan]="columnNames.length"
              >
                {{ noDataFoundMessage }}
              </td>
            </tr>

            <tr mat-header-row *matHeaderRowDef="columnNames"></tr>
            <tr mat-row *matRowDef="let row; columns: columnNames"></tr>
          </table>
        </div>
        <mat-paginator
          [length]="datatableHandler.totalCount"
          [pageSizeOptions]="pageSizeOptions"
          showFirstLastButtons
        >
        </mat-paginator>
      </div>
    </ng-container>
  </mat-sidenav-content>
</mat-sidenav-container>
